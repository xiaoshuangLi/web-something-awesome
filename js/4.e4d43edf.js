webpackJsonp([4],{657:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),a(716);var n=a(717),i=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default=i.default,t.exports=e.default},661:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a(71),u=n(i),o=a(12),r=n(o),s=a(13),c=n(s),d=function(){function t(){(0,r.default)(this,t)}return(0,c.default)(t,[{key:"setState",value:function(t,e){var a=this.state,n=void 0===a?{}:a;this.state=(0,u.default)({},n,t),e&&e()}}]),t}();e.default=d,t.exports=e.default},662:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a(273),u=n(i),o=a(71),r=n(o),s=a(99),c=n(s),d=a(156),l=n(d),f=a(26),h=n(f),v=a(12),p=n(v),g=a(13),m=n(g),_=a(27),w=n(_),x=a(28),y=n(x),M=a(155),b=a(661),k=n(b),D=a(667),j=n(D),P=new Worker(j.default),A=function(t){P.postMessage(t)},I=function(t){P.onmessage=function(e){t&&t(e.data)}},S={useImageData:!1,size:1,exclude:[[255,255,255],[0,0,0,0]],include:[],imgs:[]},C=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,p.default)(this,e);for(var a=(0,w.default)(this,(e.__proto__||(0,h.default)(e)).call(this,t)),n=(0,l.default)(t),i=n.length,u={},o=0;o<i;o++){var s=n[o],d=t[s];switch(void 0===d?"undefined":(0,c.default)(d)){case"function":a[s]=d.bind(a);break;default:u[s]=d}}return a.state=(0,r.default)({},S,u),a._partAddFuncs(a._partGetSpots),a.init&&a.init(),a}return(0,y.default)(e,t),(0,m.default)(e,[{key:"_partGetSpots",value:function(){var t=this;return new u.default(function(e){if(!t.state.useImageData)return e();var a=t.state,n=a.ctx,i=a.eles,u=void 0===i?[]:i,o=a.cw,r=void 0===o?0:o,s=a.ch,c=void 0===s?0:s,d=a.exclude,l=a.include,f=a.size,h=u.map(function(t){n.clearRect(0,0,r,c);var e=t.width,a=t.height;e>=r&&(a=Math.floor(a*r/e),e=r);var i=(r-e)/2,u=(c-a)/2;return n.drawImage(t,i,u,e,a),n.getImageData(i,u,e,a)});n.clearRect(0,0,r,c),I(function(a){t.setState({spots:a}),e()}),A({imageData:h,opts:{cw:r,ch:c,exclude:d,include:l,size:f}})})}},{key:"_partAddFuncs",value:function(t,e){var a=this,n=this._partFuncs,i=void 0===n?[]:n;t=t instanceof Array?t:[t],t=t.map(function(t){return t.bind(a)}),this._partFuncs=i.concat(t),e&&this._partRefresh(e)}},{key:"_partRefresh",value:function(t){var e=this._partFuncs.map(function(t){return t()});u.default.all(e).then(t)}},{key:"_partLoad",value:function(){var t=this,e=this.state,a=e.imgs,n=void 0===a?[]:a,i=e.useImageData;return new u.default(function(e){(0,M.loadAll)(n,function(a){if(t.setState({eles:a}),!i)return e();t._partRefresh(e)})})}}]),e}(k.default);e.default=C,t.exports=e.default},664:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Part=void 0;var i=a(665),u=n(i),o=a(662),r=n(o);e.Part=r.default,e.default=u.default},665:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a(273),u=n(i),o=a(71),r=n(o),s=a(99),c=n(s),d=a(156),l=n(d),f=a(26),h=n(f),v=a(12),p=n(v),g=a(13),m=n(g),_=a(27),w=n(_),x=a(28),y=n(x),M=a(155),b=a(666),k=a(661),D=n(k),j=a(662),P=n(j);ImageData.prototype.getDataFrom=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments[1],a=this,n=a.width,i=a.data,u=(0,b.getPiexl)({list:t,width:n}),o=u.length,r=0;r<o;r++){var s=u[r],c=s.index,d=s.value;i[c]=i[c]||d}e.putImageData(a,0,0)};var A=function(t){function e(t){(0,p.default)(this,e);var a=(0,w.default)(this,(e.__proto__||(0,h.default)(e)).call(this,t));return a.state={w:t.w,h:t.h,cva:t.cva,ratio:window.devicePixelRatio,list:t.list||[]},a.action=a.action.bind(a),a.update=a.update.bind(a),a.init(),a}return(0,y.default)(e,t),(0,m.default)(e,[{key:"setCva",value:function(t){var e=this.state.ctx;return(0,l.default)(t).forEach(function(a){var n=t[a];switch(void 0===n?"undefined":(0,c.default)(n)){case"string":e[a]=n;break;case"function":n(e)}}),e}},{key:"getAttr",value:function(){var t=this.state,e=t.cva,a=t.w,n=t.h,i=this.state.ratio;e="string"==typeof e?(0,M.getEles)(e)[0]:e;var u=e.parentNode;a=a||u.clientWidth||document.body.clientWidth,n=n||u.clientHeight||document.body.clientHeight;var o=a*i,r=n*i;e.setAttribute("width",o+"px"),e.setAttribute("height",r+"px"),e.style.width=a+"px",e.style.height=n+"px";var s=e.getContext("2d");this.setState({cva:e,ctx:s,w:a,h:n,cw:o,ch:r})}},{key:"setList",value:function(){var t=this.state,e=t.ratio,a=t.cw,n=t.ch,i=t.w,u=t.h,o=t.ctx,s={ratio:e,cw:a,ch:n,w:i,h:u,ctx:o};this.state.list=this.state.list.map(function(t,e){return new P.default((0,r.default)({order:e},s,t))})}},{key:"update",value:function(){var t=this,e=this.state,a=e.list,n=void 0===a?[]:a,i=e.ctx,o=e.cw,r=e.ch,s=e.ratio,c=e.w,d=e.h;window.requestAnimationFrame(function(){for(var e=[],a=0;a<n.length;a++){var l=n[a];l.update&&e.push(l.update(i,o,r,s,c,d))}u.default.all(e).then(t.update)})}},{key:"action",value:function(){for(var t=this,e=this.state,a=e.list,n=void 0===a?[]:a,i=e.ctx,o=e.cw,r=e.ch,s=e.ratio,c=e.w,d=e.h,l=[],f=0;f<n.length;f++){var h=n[f];h._partLoad&&l.push(h._partLoad())}u.default.all(l).then(function(){n.forEach(function(t){t.render&&t.render(i,o,r,s,c,d)}),t.update()})}},{key:"init",value:function(){this.getAttr(),this.setList(),this.action()}}]),e}(D.default);e.default=A,t.exports=e.default},666:function(t,e,a){"use strict";function n(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.list,a=void 0===e?[]:e,n=t.width,i=void 0===n?0:n,u=a.length,o=[],r=0;r<u;r++)for(var s=a[r],c=s.x,d=s.y,l=s.color,f=void 0===l?[]:l,h=4*(c+(d-1)*i),v=0;v<4;v++)o.push({index:h+v,value:f[v]});return o}Object.defineProperty(e,"__esModule",{value:!0}),e.getPiexl=n},667:function(t,e,a){t.exports=a.p+"js/d3d3e3d5bdf94ded22305ef17322581e.js"},716:function(t,e){},717:function(t,e,a){"use strict";(function(t){function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a(26),u=n(i),o=a(12),r=n(o),s=a(13),c=n(s),d=a(27),l=n(d),f=a(28),h=n(f),v=a(273),p=n(v),g=a(29),m=n(g),_=a(30),w=n(_),x=a(3),y=n(x),M=a(31),b=n(M),k=a(718),D=(n(k),a(719)),j=n(D),P=a(664),A=n(P),I={Music:{displayName:"Music"}},S=(0,b.default)({filename:"/Users/xiaoshuang/xiaoshuang/save/web-something-awesome/something-awesome/frontend/js/container/canvas/pages/Music/Music.jsx",components:I,locals:[t],imports:[y.default]}),C=(0,w.default)({filename:"/Users/xiaoshuang/xiaoshuang/save/web-something-awesome/something-awesome/frontend/js/container/canvas/pages/Music/Music.jsx",components:I,locals:[],imports:[y.default,m.default]}),F=[],O={src:"http://oi9dcgq2m.bkt.clouddn.com/Hozier%20-%20Take%20Me%20To%20Church.mp3",_partLoad:function(){var t=this;return new p.default(function(e){var a=new Audio;a.preload="true",a.autoplay="true",a.loop="true",a.crossOrigin="anonymous",a.src=t.state.src,a.oncanplay=function(){t.setState({eles:[a]},e)};var n=window.AudioContext||window.webkitAudioContext,i=new n,u=i.createMediaElementSource(a),o=i.createGain(),r=i.createScriptProcessor(4096,1,1);u.connect(o),o.connect(r),r.connect(i.destination),r.onaudioprocess=function(t){for(var e=t.inputBuffer.getChannelData(0),a=t.outputBuffer.getChannelData(0),n=0;n<e.length;n+=1)a[n]=e[n];F=e}})}},E={imgs:[j.default],useImageData:!0,size:3,render:function(t,e,a){var n=this.state.spots,i=void 0===n?[]:n;t.createImageData(e,a).getDataFrom(i[0],t)},update:function(t,e,a){for(var n=this.state,i=n.spots,u=void 0===i?[]:i,o=n.eles,r=void 0===o?[]:o,s=u[0],c=r[0],d=c.height,l=d/2,f=a/2,h=F,v=h.length,p=t.createImageData(e,a),g=e/2,m=p.data,_=void 0===m?[]:m,w=3;w<_.length;w+=4)_[w]=255;for(var x=0;x<s.length;x++){var y=s[x],M=Math.abs(y.y-f);M=M>l?l:M;var b=Math.ceil(M/l*(v-1)),k=F[b]+1,D=Math.ceil(3*k);y.start=y.start||y.x,y.target=L?y.start:Math.ceil((y.start-g)*k+g),y.x=y.target>y.x?y.x+D:y.x-D,y.color=[255,255,255,255],s[x]=y}p.getDataFrom(s,t)}},L=!1,R=function(t){return function(e){return S(C(e,t),t)}}("Music")(function(t){function e(){return(0,r.default)(this,e),(0,l.default)(this,(e.__proto__||(0,u.default)(e)).apply(this,arguments))}return(0,h.default)(e,t),(0,c.default)(e,[{key:"componentDidMount",value:function(){this.init()}},{key:"init",value:function(){new A.default({cva:"#canvas",list:[E,O]}).setCva({fillStyle:"black"})}},{key:"render",value:function(){return y.default.createElement("div",{className:"page-canvas-music-render"},y.default.createElement("canvas",{id:"canvas",onMouseEnter:function(){L=!0},onMouseLeave:function(){L=!1}}))}}]),e}(x.Component));e.default=R,t.exports=e.default}).call(e,a(15)(t))},718:function(t,e,a){t.exports=a.p+"img/b30d7d6b39820f10f86705a39ce81609.jpg"},719:function(t,e,a){t.exports=a.p+"img/798c11c6a22e5cb4f85ada6dfbbd0237.svg"}});